{% extends 'barra_navegacion/barra.html' %}

{% block title %} Clientes {% endblock %}

{% block content %}

<form method="POST">
  {% csrf_token %}
  <div class="text-2xl font-semibold text-gray-800 mb-4">
    <h2>Agregar Nuevo Cliente</h2>
  </div>

<div class="max-w-3xl grid grid-cols-1 md:grid-cols-2 gap-4 mt-6">
    
  <label class="flex flex-col text-xs font-sans text-gray-500">
    <span class="mb-1 font-semibold tracking-wide">Nombre</span>
    <input type="text" name="nombre" required class="border border-gray-300 rounded-md py-1 px-3 text-sm font-sans text-gray-900 bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500"/>
  </label>

  <label class="flex flex-col text-xs font-sans text-gray-500">
    <span class="mb-1 font-semibold tracking-wide">Cédula o RUC</span>
    <input type="text" name="cedula" class="w-40 border border-gray-300 rounded-md py-1 px-3 text-sm font-sans text-gray-900 bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500"/>
  </label>

  <label class="flex flex-col text-xs font-sans text-gray-500">
    <span class="mb-1 font-semibold tracking-wide">Celular</span>
    <input type="text" name="celular" class="w-40 border border-gray-300 rounded-md py-1 px-3 text-sm font-sans text-gray-900 bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500"/>
  </label>

  <label class="flex flex-col text-xs font-sans text-gray-500 md:col-span-2">
    <span class="mb-1 font-semibold tracking-wide">Dirección</span>
    <textarea name="direccion" rows="2" class="border border-gray-300 rounded-md py-1 px-3 text-sm font-sans text-gray-900 bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none"></textarea>
  </label>

  <label class="flex flex-col text-xs font-sans text-gray-500">
    <span class="mb-1 font-semibold tracking-wide">Correo</span>
    <input type="email" name="correo" class="border border-gray-300 rounded-md py-1 px-3 text-sm font-sans text-gray-900 bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500"/>
  </label>

  <label class="flex flex-col text-xs font-sans text-gray-500">
    <span class="mb-1 font-semibold tracking-wide">Provincia</span>
    <input type="text" name="provincia" class="border border-gray-300 rounded-md py-1 px-3 text-sm font-sans text-gray-900 bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500"/>
  </label>

  <div class="md:col-span-2 flex  mt-4">
    <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-1 px-6 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500"> Guardar Cliente </button>
  </div>
</div>


</form>

<div class="text-2xl font-semibold text-gray-800 mb-4">
    <h2>Clientes Registrados</h2>
</div>

<!-- Tabla de clientes bonitamente estilizada -->
<div class="overflow-x-auto mt-8">
  <div class="bg-white rounded-2xl shadow-md p-4">
    <table class="min-w-full border-separate border-spacing-x-2 border-spacing-y-2 text-sm text-left text-gray-700">
      <thead>
        <tr class="text-gray-600 text-xs font-semibold uppercase tracking-wider">
          <th class="px-4 py-2">Nombre</th>
          <th class="px-4 py-2">Cédula/RUC</th>
          <th class="px-4 py-2">Celular</th>
          <th class="px-4 py-2">Dirección</th>
          <th class="px-4 py-2">Correo</th>
          <th class="px-4 py-2">Provincia</th>
          <th class="px-4 py-2">Acciones</th>

        </tr>
      </thead>
      <tbody>
        {% for cliente in clientes_diccionario %}
          <tr class="hover:bg-gray-50 transition">
            <td class="px-4 py-2 font-semibold text-gray-900">{{ cliente.nombre }}</td>
            <td class="px-4 py-2 max-w-[100px] truncate" title="{{ cliente.ruc_cedula }}" >{{ cliente.ruc_cedula }}</td>
            <td class="px-4 py-2">{{ cliente.celular }}</td>
            <td class="px-4 py-2 max-w-[100px] truncate" title="{{ cliente.direccion }}">{{ cliente.direccion }}</td>
            <td class="px-4 py-2 text-blue-600">{{ cliente.correo }}</td>
            <td class="px-4 py-2">{{ cliente.provincia }}</td>
            <td class="px-4 py-2">
              <div class="flex items-center gap-3">
                <button class="fa-solid fa-pen-to-square text-blue-600 hover:text-blue-800 cursor-pointer" onclick="abrirModalEditar(
                  '{{cliente.id}}', 
                  '{{cliente.nombre|escapejs}}', 
                  '{{cliente.ruc_cedula|escapejs}}', 
                  '{{cliente.celular|escapejs}}', 
                  '{{cliente.direccion|escapejs}}', 
                  '{{cliente.correo|escapejs}}', 
                  '{{cliente.provincia|escapejs}}')">
                  </button>

                <i class="fa-solid fa-trash text-red-600 hover:text-red-800 cursor-pointer" onclick="abrirModalEliminar('{{ cliente.id }}', '{{ cliente.nombre }}')"></i>
              </div>
            </td>
          </tr>
        {% empty %}
          <tr>
            <td colspan="6" class="px-4 py-4 text-center text-gray-500">No hay clientes registrados</td>
          </tr>
        {% endfor %}
      </tbody>


    </table>
          <!-- Modal de Eliminar -->
    <div id="modalEliminar" class="fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center hidden z-50">
      <div class="bg-white p-6 rounded-lg shadow-xl w-full max-w-md">
        <h2 class="text-lg font-semibold mb-4 text-gray-800">¿Eliminar cliente?</h2>
        <p class="mb-6 text-gray-600" id="modalTexto"></p>

        <form method="POST" action="{% url 'eliminar_cliente' %}">
          {% csrf_token %}
          <input type="hidden" name="cliente_id" id="modalClienteId">
          <div class="flex justify-end gap-3">
            <button type="button" onclick="cerrarModal()" class="px-4 py-2 bg-gray-300 hover:bg-gray-400 rounded">Cancelar</button>
            <button type="submit" class="px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded">Eliminar</button>
          </div>
        </form>
      </div>
    </div>
          <!-- Modal de confirmación -->
    <div id="modalEditar" class="fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center hidden z-50">
      <div class="bg-white p-6 rounded-lg shadow-xl w-full max-w-lg">
        <h2 class="text-lg font-semibold mb-4 text-gray-800">Editar Cliente</h2>

        <form id="formEditarCliente" method="POST" action="{% url 'editar_cliente' %}">
        {% csrf_token %}
        <input type="hidden" name="modalClienteId" id="editarClienteId">
        <div class="grid grid-cols-1 gap-4 mb-4">
          <input type="text" id="editarNombre" name="nombre" class="border p-2 rounded w-full">
          <input type="text" id="editarCedula" name="ruc_cedula" class="border p-2 rounded w-full">
          <input type="text" id="editarCelular" name="celular" class="border p-2 rounded w-full">
          <textarea type="text" id="editarDireccion" name="direccion" class="border p-2 rounded w-full"></textarea>
          <input type="email" id="editarCorreo" name="correo" class="border p-2 rounded w-full">
          <input type="text" id="editarProvincia" name="provincia" class="border p-2 rounded w-full">
        </div>
        <div class="flex justify-end gap-4">
          <button type="button" onclick="cerrarModalEditar()" class="bg-gray-300 text-gray-800 px-4 py-2 rounded hover:bg-gray-400">Cancelar</button>
          <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">Actualizar</button>
        </div>
        </form>
      </div>

    </div>


  </div>
</div>


<!-- Mensajes -->
{% if messages %}
  <ul class="mt-4 text-sm text-green-600">
    {% for message in messages %}
      <li>{{ message }}</li>
    {% endfor %}
  </ul>
{% endif %}



{% endblock %}
