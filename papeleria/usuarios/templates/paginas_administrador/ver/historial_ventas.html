{% extends 'barra_navegacion/barra.html' %}
{% block title %} Historial {% endblock %}

{% block content %}
<div class="max-w-6xl mx-auto p-4 space-y-4">

  <h1 class="text-2xl font-semibold">Historial de Ventas</h1>

  <!-- Controles de filtro -->
  <div class="bg-white rounded-xl shadow p-4 flex flex-col gap-3 md:flex-row md:items-end md:justify-between">
    <!-- Botón HOY -->
    <form method="get" class="flex items-center gap-2">
      <input type="hidden" name="hoy" value="1">
      <button
        class="px-4 py-2 rounded-lg bg-blue-600 text-white hover:bg-blue-700 transition"
        title="Mostrar facturas del día de hoy"
      >
        HOY
      </button>
    </form>

    <!-- Rango de fechas -->
    <form method="get" class="flex flex-wrap items-end gap-2">
      <div class="flex flex-col">
        <label for="start" class="text-sm text-gray-600">Desde</label>
        <input
          type="date" id="start" name="start"
          value="{{ start_value }}"
          class="border rounded-lg px-3 py-2"
        >
      </div>
      <div class="flex flex-col">
        <label for="end" class="text-sm text-gray-600">Hasta</label>
        <input
          type="date" id="end" name="end"
          value="{{ end_value }}"
          class="border rounded-lg px-3 py-2"
        >
      </div>
      <button
        class="px-4 py-2 rounded-lg bg-emerald-600 text-white hover:bg-emerald-700 transition"
        title="Buscar por rango"
      >
        Buscar
      </button>
      <!-- Limpiar: vuelve al estado vacío -->
      <a
        href=""
        class="px-4 py-2 rounded-lg bg-gray-200 text-gray-800 hover:bg-gray-300 transition"
        title="Limpiar filtros"
      >
        Limpiar
      </a>
    </form>
  </div>

  <!-- Estado inicial / resultados -->
  {% if not aplico_filtro %}
    <div class="text-gray-600">
      Usa <span class="font-semibold">HOY</span> o el <span class="font-semibold">rango de fechas</span> para mostrar facturas.
    </div>
  {% else %}
    {% if facturas %}
      <div class="overflow-x-auto bg-white rounded-xl shadow">
        <table class="min-w-full divide-y divide-gray-200">
          <thead class="bg-gray-50">
            <tr>
                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">N° Factura</th>
                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Cliente</th>
                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">PDF</th>
                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Acciones</th>
            </tr>
            </thead>

          <tbody class="bg-white divide-y divide-gray-100">
            {% for f in facturas %}
              <tr class="hover:bg-gray-50">
                <td class="px-4 py-3 text-gray-800">#{{ f.id }}</td>
                <td class="px-4 py-3">
                  {{ f.cliente|default:"Consumidor Final" }}
                </td>
                <td class="px-4 py-3">
                  <a
                    href="{% url 'factura_pdf' f.id %}"
                    target="_blank"
                    class="inline-flex items-center p-2 rounded-lg border border-gray-200 hover:bg-gray-50"
                    title="Ver PDF"
                  >
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24"
                         stroke="currentColor" stroke-width="1.5">
                      <path stroke-linecap="round" stroke-linejoin="round"
                            d="M19.5 14.25v-6.6a1.5 1.5 0 00-.44-1.06l-2.65-2.65A1.5 1.5 0 0015.35 3H8.25A2.25 2.25 0 006 5.25v13.5A2.25 2.25 0 008.25 21h7.5A2.25 2.25 0 0018 18.75V15m-9-.75h2.25M9 12h3.75M9 9h3.75M15.75 15h2.25M18 15v3m0 0h3m-3 0h-3" />
                    </svg>
                    <span class="sr-only">Ver PDF</span>
                  </a>
                </td>
                <td class="px-4 py-3">
                <form action="{% url 'eliminar_venta' f.id %}" method="post" onsubmit="return confirm('¿Eliminar la venta #{{ f.id }} y revertir stock?');">
                    {% csrf_token %}
                    <button
                    type="submit"
                    class="px-3 py-1.5 rounded-lg bg-red-600 text-white hover:bg-red-700 transition"
                    title="Eliminar venta y revertir stock"
                    >
                    Eliminar venta
                    </button>
                </form>
                </td>

              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    {% else %}
      <div class="text-gray-600">
        No se encontraron facturas para el filtro aplicado.
      </div>
    {% endif %}
  {% endif %}
</div>
{% endblock %}
